any_exercise_last_month + binge_drinking + max_drinks_30day +
interview_year,
data = vars)
vif(lm_temp)
anova(lm_temp)
dummies <- model.matrix(obese ~ ., data = vars)[, -1]
dummies <- as.data.frame(dummies)
set.seed(123)
train_index <- createDataPartition(vars$obese, p = 0.7, list = FALSE)
train <- vars[train_index, ]
test  <- vars[-train_index, ]
dummies <- model.matrix(obese ~ ., data = vars)[, -1]
dummies <- as.data.frame(dummies)
pred_prob <- predict(log_model, test, type = "response")
log_model <- glm(
obese ~ age + sex + race_ethnicity + income_category +
any_exercise_last_month + binge_drinking + max_drinks_30day +
interview_year,
data = train,
family = binomial
)
summary(log_model)
pred_prob <- predict(log_model, test, type = "response")
pred_class <- ifelse(pred_prob > 0.5, "Yes", "No")
confusionMatrix(as.factor(pred_class), test$obese)
# ROC / AUC
roc_obj <- roc(test$obese, pred_prob)
plot(roc_obj)
auc(roc_obj)
logLik(log_model)
AIC(log_model)
pR2(log_model)
library(tidyverse)
library(lattice)
library(corrplot)
library(car)
library(caret)
library(leaps)
library(bestglm)
library(pROC)
library(pscl)
library(rpart)
library(rpart.plot)
library(randomForest)
library(MASS)
library(glmnet)
###############################################
# DATA PREP
###############################################
brfss = readRDS("../Data/Processed/brfss_2018_2023.rds")
brfss_postcovid <- subset(brfss, interview_year >= 2020)
brfss_postcovid$obese <- ifelse(brfss_postcovid$bmi >= 30, 1, 0)
brfss_postcovid$obese <- factor(brfss_postcovid$obese, labels = c("No","Yes"))
###############################################
# SELECT VARIABLES FOR ANALYSIS
###############################################
vars <- brfss_postcovid %>%
dplyr::select(obese, bmi, age, sex, race_ethnicity, income_category,
any_exercise_last_month, binge_drinking,
max_drinks_30day, interview_year)
###############################################
# 1. CORRELATION (PEARSON & SPEARMAN)
###############################################
numeric_vars <- vars %>% dplyr::select(age, bmi, max_drinks_30day, interview_year)
# Pearson
pearson_corr <- cor(numeric_vars, use = "complete.obs", method = "pearson")
print(pearson_corr)
# Spearman
spearman_corr <- cor(numeric_vars, use = "complete.obs", method = "spearman")
print(spearman_corr)
# Heatmap
corrplot(pearson_corr, method = "color", type = "upper")
###############################################
# 2. LATTICE PLOTS
###############################################
# Density plot by obesity status
densityplot(~ bmi | obese, data = vars)
# Boxplot income vs BMI
bwplot(bmi ~ income_category, data = vars)
# Scatterplot with regression line
xyplot(bmi ~ age,
groups = obese,
data = vars,
auto.key = TRUE,
type = c("p", "r"))
###############################################
# 3. MULTICOLLINEARITY (VIF)
###############################################
# Fit a temporary linear model for VIF
lm_temp <- lm(bmi ~ age + sex + race_ethnicity + income_category +
any_exercise_last_month + binge_drinking + max_drinks_30day +
interview_year,
data = vars)
vif(lm_temp)
###############################################
# 4. F-TEST FOR MODEL FIT (Linear Regression EDA)
###############################################
anova(lm_temp)
###############################################
# 5. ONE-HOT ENCODING
###############################################
dummies <- model.matrix(obese ~ ., data = vars)[, -1]
dummies <- as.data.frame(dummies)
###############################################
# 7. LOGISTIC REGRESSION
###############################################
log_model <- glm(
obese ~ age + sex + race_ethnicity + income_category +
any_exercise_last_month + binge_drinking + max_drinks_30day +
interview_year,
data = train,
family = binomial
)
summary(log_model)
###############################################
# 8. MODEL EVALUATION (LOGISTIC)
###############################################
# Predictions
pred_prob <- predict(log_model, test, type = "response")
pred_class <- ifelse(pred_prob > 0.5, "Yes", "No")
# Confusion matrix
confusionMatrix(as.factor(pred_class), test$obese)
# ROC / AUC
roc_obj <- roc(test$obese, pred_prob)
plot(roc_obj)
auc(roc_obj)
# Deviance & AIC
logLik(log_model)
AIC(log_model)
# McFadden pseudo-R2
pR2(log_model)
regfit <- regsubsets(
obese ~ age + sex + race_ethnicity + income_category +
any_exercise_last_month + binge_drinking + max_drinks_30day +
interview_year,
data = train,
nvmax = 10
)
reg_summary <- summary(regfit)
reg_summary$adjr2
reg_summary$bic
reg_summary$cp
bestglm_data <- data.frame(
obese = as.numeric(train$obese) - 1,
dummies
)
bestglm_data <- data.frame(
obese = as.numeric(train$obese) - 1,
dummies
)
dummies <- model.matrix(obese ~ ., data = vars)[, -1]
dummies <- as.data.frame(dummies)
bestglm_data <- data.frame(
obese = as.numeric(train$obese) - 1,
dummies
)
set.seed(123)
train_index <- createDataPartition(vars$obese, p = 0.7, list = FALSE)
train <- vars[train_index, ]
test  <- vars[-train_index, ]
bestglm_data <- data.frame(
obese = as.numeric(train$obese) - 1,
dummies
)
library(tidyverse)
library(lattice)
library(corrplot)
library(car)
library(caret)
library(leaps)
library(bestglm)
library(pROC)
library(pscl)
library(rpart)
library(rpart.plot)
library(randomForest)
library(MASS)
library(glmnet)
###############################################
# DATA PREP
###############################################
brfss = readRDS("../Data/Processed/brfss_2018_2023.rds")
brfss_postcovid <- subset(brfss, interview_year >= 2020)
brfss_postcovid$obese <- ifelse(brfss_postcovid$bmi >= 30, 1, 0)
brfss_postcovid$obese <- factor(brfss_postcovid$obese, labels = c("No","Yes"))
###############################################
# SELECT VARIABLES FOR ANALYSIS
###############################################
vars <- brfss_postcovid %>%
dplyr::select(obese, bmi, age, sex, race_ethnicity, income_category,
any_exercise_last_month, binge_drinking,
max_drinks_30day, interview_year)
###############################################
# 1. CORRELATION (PEARSON & SPEARMAN)
###############################################
numeric_vars <- vars %>% dplyr::select(age, bmi, max_drinks_30day, interview_year)
# Pearson
pearson_corr <- cor(numeric_vars, use = "complete.obs", method = "pearson")
print(pearson_corr)
# Spearman
spearman_corr <- cor(numeric_vars, use = "complete.obs", method = "spearman")
print(spearman_corr)
# Heatmap
corrplot(pearson_corr, method = "color", type = "upper")
###############################################
# 2. LATTICE PLOTS
###############################################
# Density plot by obesity status
densityplot(~ bmi | obese, data = vars)
# Boxplot income vs BMI
bwplot(bmi ~ income_category, data = vars)
# Scatterplot with regression line
xyplot(bmi ~ age,
groups = obese,
data = vars,
auto.key = TRUE,
type = c("p", "r"))
###############################################
# 3. MULTICOLLINEARITY (VIF)
###############################################
# Fit a temporary linear model for VIF
lm_temp <- lm(bmi ~ age + sex + race_ethnicity + income_category +
any_exercise_last_month + binge_drinking + max_drinks_30day +
interview_year,
data = vars)
vif(lm_temp)
###############################################
# 4. F-TEST FOR MODEL FIT (Linear Regression EDA)
###############################################
anova(lm_temp)
###############################################
# 5. ONE-HOT ENCODING
###############################################
dummies <- model.matrix(obese ~ ., data = vars)[, -1]
dummies <- as.data.frame(dummies)
###############################################
# 6. TRAIN/TEST SPLIT
###############################################
set.seed(123)
train_index <- createDataPartition(vars$obese, p = 0.7, list = FALSE)
train <- vars[train_index, ]
test  <- vars[-train_index, ]
###############################################
# 7. LOGISTIC REGRESSION
###############################################
log_model <- glm(
obese ~ age + sex + race_ethnicity + income_category +
any_exercise_last_month + binge_drinking + max_drinks_30day +
interview_year,
data = train,
family = binomial
)
summary(log_model)
###############################################
# 8. MODEL EVALUATION (LOGISTIC)
###############################################
# Predictions
pred_prob <- predict(log_model, test, type = "response")
pred_class <- ifelse(pred_prob > 0.5, "Yes", "No")
# Confusion matrix
confusionMatrix(as.factor(pred_class), test$obese)
# ROC / AUC
roc_obj <- roc(test$obese, pred_prob)
plot(roc_obj)
auc(roc_obj)
# Deviance & AIC
logLik(log_model)
AIC(log_model)
# McFadden pseudo-R2
pR2(log_model)
###############################################
# 9. MODEL SELECTION — regsubsets()
###############################################
regfit <- regsubsets(
obese ~ age + sex + race_ethnicity + income_category +
any_exercise_last_month + binge_drinking + max_drinks_30day +
interview_year,
data = train,
nvmax = 10
)
reg_summary <- summary(regfit)
reg_summary$adjr2
reg_summary$bic
reg_summary$cp
bestglm_data <- data.frame(
obese = as.numeric(train$obese) - 1,
dummies
)
set.seed(123)
train_index <- createDataPartition(vars$obese, p = 0.7, list = FALSE)
train <- vars[train_index, ]
test  <- vars[-train_index, ]
train_dummies <- model.matrix(obese ~ ., data = train)[, -1]
train_dummies <- as.data.frame(train_dummies)
bestglm_data <- data.frame(
obese = as.numeric(train$obese) - 1,  # convert factor Yes/No → 1/0
train_dummies
)
bestglm_model <- bestglm(
bestglm_data,
family = binomial,
IC = "AIC"
)
best_model <- bestglm(bestglm_data, family = binomial, IC = "BIC")
View(dummies)
bestglm_model <- bestglm(
bestglm_data,
family = binomial,
IC = "AIC"
)
str(train_dummies)
bestglm_data <- data.frame(
obese = as.numeric(train$obese) - 1,  # convert factor Yes/No → 1/0
train_dummies
)
bestglm_data <- na.omit(bestglm_data)
bestglm_model <- bestglm(
Xy = bestglm_data,
family = binomial,
method = "wald",
IC = "AIC"
)
library(tidyverse)
library(lattice)
library(corrplot)
library(car)
library(caret)
library(leaps)
library(bestglm)
library(pROC)
library(pscl)
library(rpart)
library(rpart.plot)
library(randomForest)
library(MASS)
library(glmnet)
###############################################
# DATA PREP
###############################################
brfss = readRDS("../Data/Processed/brfss_2018_2023.rds")
brfss_postcovid <- subset(brfss, interview_year >= 2020)
brfss_postcovid$obese <- ifelse(brfss_postcovid$bmi >= 30, 1, 0)
brfss_postcovid$obese <- factor(brfss_postcovid$obese, labels = c("No","Yes"))
###############################################
# SELECT VARIABLES FOR ANALYSIS
###############################################
vars <- brfss_postcovid %>%
dplyr::select(obese, bmi, age, sex, race_ethnicity, income_category,
any_exercise_last_month, binge_drinking,
max_drinks_30day, interview_year)
###############################################
# 1. CORRELATION (PEARSON & SPEARMAN)
###############################################
numeric_vars <- vars %>% dplyr::select(age, bmi, max_drinks_30day, interview_year)
# Pearson
pearson_corr <- cor(numeric_vars, use = "complete.obs", method = "pearson")
print(pearson_corr)
# Spearman
spearman_corr <- cor(numeric_vars, use = "complete.obs", method = "spearman")
print(spearman_corr)
# Heatmap
corrplot(pearson_corr, method = "color", type = "upper")
###############################################
# 2. LATTICE PLOTS
###############################################
# Density plot by obesity status
densityplot(~ bmi | obese, data = vars)
# Boxplot income vs BMI
bwplot(bmi ~ income_category, data = vars)
# Scatterplot with regression line
xyplot(bmi ~ age,
groups = obese,
data = vars,
auto.key = TRUE,
type = c("p", "r"))
###############################################
# 3. MULTICOLLINEARITY (VIF)
###############################################
# Fit a temporary linear model for VIF
lm_temp <- lm(bmi ~ age + sex + race_ethnicity + income_category +
any_exercise_last_month + binge_drinking + max_drinks_30day +
interview_year,
data = vars)
vif(lm_temp)
###############################################
# 4. F-TEST FOR MODEL FIT (Linear Regression EDA)
###############################################
anova(lm_temp)
###############################################
# 5. ONE-HOT ENCODING
###############################################
dummies <- model.matrix(obese ~ ., data = vars)[, -1]
dummies <- as.data.frame(dummies)
###############################################
# 6. TRAIN/TEST SPLIT
###############################################
set.seed(123)
train_index <- createDataPartition(vars$obese, p = 0.7, list = FALSE)
train <- vars[train_index, ]
test  <- vars[-train_index, ]
###############################################
# 7. LOGISTIC REGRESSION
###############################################
log_model <- glm(
obese ~ age + sex + race_ethnicity + income_category +
any_exercise_last_month + binge_drinking + max_drinks_30day +
interview_year,
data = train,
family = binomial
)
summary(log_model)
###############################################
# 8. MODEL EVALUATION (LOGISTIC)
###############################################
# Predictions
pred_prob <- predict(log_model, test, type = "response")
pred_class <- ifelse(pred_prob > 0.5, "Yes", "No")
# Confusion matrix
confusionMatrix(as.factor(pred_class), test$obese)
# ROC / AUC
roc_obj <- roc(test$obese, pred_prob)
plot(roc_obj)
auc(roc_obj)
# Deviance & AIC
logLik(log_model)
AIC(log_model)
# McFadden pseudo-R2
pR2(log_model)
###############################################
# 9. MODEL SELECTION — regsubsets()
###############################################
regfit <- regsubsets(
obese ~ age + sex + race_ethnicity + income_category +
any_exercise_last_month + binge_drinking + max_drinks_30day +
interview_year,
data = train,
nvmax = 10
)
reg_summary <- summary(regfit)
reg_summary$adjr2
reg_summary$bic
reg_summary$cp
###############################################
# 10. MODEL SELECTION — bestglm()
###############################################
bestglm_data <- data.frame(
obese = as.numeric(train$obese) - 1,
dummies
)
train_dummies <- model.matrix(obese ~ ., data = train)[, -1]
train_dummies <- as.data.frame(train_dummies)
bestglm_data <- data.frame(
obese = as.numeric(train$obese) - 1,
train_dummies
)
best_model <- bestglm(
bestglm_data,
family = binomial,
IC = "BIC"
)
bestglm_data <- data.frame(
y = ifelse(train$obese == "Yes", 1, 0),
train_dummies
)
bestglm_data <- na.omit(bestglm_data)
best_model <- bestglm(
bestglm_data,
family = binomial,
IC = "BIC"
)
X <- model.matrix(obese ~ .,
data = train)[, -1]  # remove intercept
# remove any constant columns (bestglm cannot handle them)
X <- X[, apply(X, 2, var) != 0]
# convert to data frame
X <- as.data.frame(X)
y <- ifelse(train$obese == "Yes", 1, 0)
bestglm_data <- cbind.data.frame(y = y, X)
# remove NA rows if any
bestglm_data <- na.omit(bestglm_data)
best_model <- bestglm(
bestglm_data,
family = binomial,
IC = "BIC"
)
str(bestglm_data[,1, drop = FALSE])
sapply(bestglm_data, class)
X <- model.matrix(obese ~ ., data = train)[, -1]
# 2. Convert to plain numeric dataframe (remove all attributes)
X_clean <- as.data.frame(lapply(as.data.frame(X), function(col) {
as.numeric(col)
}))
y <- ifelse(train$obese == "Yes", 1, 0)
# 4. Combine
bestglm_data <- cbind.data.frame(y = y, X_clean)
# 5. Remove rows with NA
bestglm_data <- na.omit(bestglm_data)
zero_var_cols <- which(apply(bestglm_data[,-1], 2, function(x) var(x) == 0))
if(length(zero_var_cols) > 0){
bestglm_data <- bestglm_data[, - (zero_var_cols + 1)]
}
# 7. Drop any non-finite values
bestglm_data <- bestglm_data[, sapply(bestglm_data, function(col) all(is.finite(col)))]
# 8. Convert *again* to pure numeric (de-attribute a second time)
bestglm_data <- as.data.frame(lapply(bestglm_data, as.numeric))
best_model <- bestglm(
bestglm_data,
family = binomial,
IC = "BIC"
)
ncol(bestglm_data)
summary(bestglm_data)
